networks:
  otel-network:
    driver: bridge

services:
  jaeger:
    image: jaegertracing/all-in-one:1.54
    container_name: jaeger
    environment:
      - OTEL_TRACES_SAMPLER=always_off
      - COLLECTOR_ZIPKIN_HTTP_PORT=9411
    networks:
      - otel-network
    ports:
      - "16686:16686"
      - "14250:14250"
      - "14268:14268"
      - "9411:9411"
    command: ["--collector.zipkin.host-port=:9411", "--log-level=debug"]

  otel-collector:
    build: ./docker/otel-collector/
    container_name: otel-collector
    # image: otel/opentelemetry-collector-contrib:0.119.0
    volumes:
    - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml
    networks:
      - otel-network
    ports:
      - "4317:4317" # OTLP gRPC
      - "4318:4318" # OTLP HTTP
    depends_on:
      - jaeger

  budger-tracker-api-v2:
    build: ./
    container_name: budger-tracker-api-v2
    environment:
      MONGODB_HOST: "mongodb://mongodb:27017/"
      MONGODB_USER: "root"
      MONGODB_PASS: "example"
    ports:
      - "8080:8080"
    links:
      - mongodb
    networks:
      - otel-network
    depends_on:
      - mongodb
  mongodb:
    image: mongo:8.0.15
    container_name: mongodb
    restart: always
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example
    ports:
    - 27017:27017
    networks:
      - otel-network
  mongo_seed:
    build: ./docker/mongo-seed
    links:
      - mongodb
    volumes:
      - ./docker/mongo-seed:/mongo-seed
    command:
      /mongo-seed/import.sh
    networks:
      - otel-network
    depends_on:
      - otel-collector